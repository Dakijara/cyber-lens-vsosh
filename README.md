# КиберЛинза (CyberLens) - проверка ссылок и файлов через Kaspersky OpenTIP (KTIP)

## Возможности

1) Проверка URL/домена
- Проверка введённого URL через popup.
- Проверка ссылки из контекстного меню (ПКМ по ссылке или выделенному тексту-> «КиберЛинза: проверить ссылку»).

2) Проверка файла
- Отдельная страница `filecheck.html` для выбора файла (это решает ограничение Firefox: при открытии системного диалога выбора файла popup закрывается).
- Локальный расчёт SHA-256 и отправка на проверку только хеша.

3) Настройки
- Иконка «шестерёнка (⛭)» открывает оверлей быстрых настроек (API-ключ, язык, тема).
- Кнопка «Больше настроек» открывает полноценную страницу настроек (WIP).

---

## Требования

- Firefox 78 и выше
- Доступ к KTIP: требуется API-ключ

---

## Установка (временное расширение)

1) Скачайте проект (или распакуйте архив) в отдельную папку.
2) Откройте Firefox и перейдите:
   - `about:debugging#/runtime/this-firefox`
3) Нажмите:
   - «Загрузить временное дополнение…»
4) Укажите файл:
   - `manifest.json` (в корне проекта)

После загрузки появится иконка расширения на панели браузера.

---

## Получение API-ключа OpenTIP (KTIP)

1) Авторизуйтесь на портале OpenTIP.
2) Создайте токен и скопируйте API-ключ по ссылке (https://opentip.kaspersky.com/token).
3) Вставьте API-ключ в «Быстрых настройках» (⛭ в popup) или на странице настроек.

Ссылка на справку по управлению токеном (официальная документация OpenTIP):
- https://opentip.kaspersky.com/Help_ru/Doc_data/ManagingToken.htm

---

## Использование

### Проверка через popup
1) Нажмите на иконку расширения -> откроется `popup.html`.
2) Введите URL и нажмите «Проверить URL».
3) Либо вставьте хэш (MD5/SHA1/SHA256 в hex) и нажмите «Проверить HASH».
4) Для проверки файла нажмите кнопку открытия страницы проверки файла:
   - откроется вкладка `filecheck.html`, где можно выбрать файл и выполнить проверку.

### Проверка из контекстного меню
- ПКМ по ссылке -> «КиберЛинза: проверить ссылку» -> результат придёт уведомлением.
- ПКМ по выделенному тексту -> «КиберЛинза: проверить выделенное как URL»
  - если выделенное не похоже на URL, расширение предложит проверить вручную через popup.

### Быстрые настройки в popup
- Нажмите «⛭»:
  - вставьте API-ключ,
  - выберите язык и тему,
  - при необходимости нажмите «Проверить ключ».

---

## Архитектура и структура проекта

### Ключевые файлы

- `manifest.json`
  - Описание расширения, разрешения, фоновые скрипты, popup и options.

- `popup.html`
  - UI popup: ввод URL/хеша, отображение последнего результата, быстрые настройки (оверлей).

- `src/popup.js`
  - Логика popup:
    - отправка сообщений в background (`browser.runtime.sendMessage`)
    - открытие оверлея быстрых настроек
    - сохранение настроек (API-ключ/язык/тема)
    - запрос последнего результата (`GET_LAST_RESULT`)

- `options.html`
  - Cтраница расширенных настроек (открывается в отдельной вкладке).

- `src/options.js`
  - Логика страницы настроек: сохранение параметров и проверка ключа.

- `filecheck.html`
  - Отдельная страница для выбора файла, вычисления его хеша, и проверки.

- `src/filecheck.js`
  - Локальный расчёт SHA-256 (`crypto.subtle.digest("SHA-256", ...)`)
  - отправка `CHECK_HASH` вместе с метаданными (имя/размер файла)

- `src/background.js`
  - Центральный обработчик:
    - контекстные меню (`browser.contextMenus`)
    - приём сообщений:
      - `CHECK_URL`
      - `CHECK_HASH`
      - `GET_LAST_RESULT`
    - сохранение последнего результата и показ уведомлений.

- `src/api.js`
  - Обёртка над OpenTIP API (`https://opentip.kaspersky.com/api/v1`)
  - Запросы:
    - `/search/domain?request=...`
    - `/search/hash?request=...`
  - Заголовок авторизации:
    - `X-API-KEY: <token>`

- `src/storage.js`
  - Работа с `browser.storage.local`
  - Хранение настроек и `lastResult`.

- `src/utils.js`
  - Нормализация URL, базовые валидаторы (URL/хэш), обработка ответа.

- `styles/popup.css`, `styles/page.css`
  - Стилизация UI (включая темы через `data-theme="light|dark"`).


---

## Будущие обновления

- История запросов.
- "Фоновый" режим работы.
- Расширенные настройки.
- Улучшение защиты API-ключа, возможно через шифрование.


---

## Интерфейс приложения

![](/ui-preview/day1.png) ![](/ui-preview/night2.png) 
![](/ui-preview/night4.png) ![](/ui-preview/day3.png)
